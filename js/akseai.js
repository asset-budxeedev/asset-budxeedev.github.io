const API_URL='https://akseai.up.railway.app/api/chat';document.addEventListener('DOMContentLoaded',()=>{const chatContainer=document.getElementById('chatContainer');const messageInput=document.getElementById('messageInput');if(!chatContainer||!messageInput){console.error("Elemen DOM yang diperlukan tidak ditemukan.");return}const userId='user_default';const chatHistory=[];function escapeHTML(str){return str.replace(/&amp;/g,"&amp;amp;").replace(/&lt;/g,"&amp;lt;").replace(/&gt;/g,"&amp;gt;").replace(/&quot;/g,"&amp;quot;").replace(/&#039;/g,"&amp;#039;")}function showTypingIndicator(){const typingIndicator=document.createElement('div');typingIndicator.className='typing-indicator';typingIndicator.innerHTML='<span></span><span></span><span></span>';typingIndicator.textContent='Akse sedang mengetik...';chatContainer.appendChild(typingIndicator);chatContainer.scrollTop=chatContainer.scrollHeight;return typingIndicator}function hideTypingIndicator(typingIndicator){if(typingIndicator)typingIndicator.remove()}window.sendMessage=async function(){const message=escapeHTML(messageInput.value.trim());if(!message){alert("Pesan tidak boleh kosong!");return}const userMessage=document.createElement('div');userMessage.className='message';userMessage.textContent=message;chatContainer.appendChild(userMessage);chatContainer.scrollTop=chatContainer.scrollHeight;messageInput.value='';chatHistory.push({role:'user',content:message});const typingIndicator=showTypingIndicator();const tittleAi=document.getElementById('titleAi');tittleAi.style.display='none';const subtitleAi=document.getElementById('subtitleAi');subtitleAi.style.display='block';try{const response=await fetch(API_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({userId,message})});if(!response.ok)throw new Error("Gagal mendapatkan respons dari server.");const data=await response.json();const aiResponse=data.response;const botResponse=document.createElement('div');botResponse.className='response';botResponse.innerHTML=marked.parse(aiResponse||"Maaf, saya tidak dapat memproses permintaan Anda saat ini.");chatContainer.appendChild(botResponse);const codeBlocks=botResponse.querySelectorAll('pre code');codeBlocks.forEach((block)=>{hljs.highlightBlock(block)});chatHistory.push({role:'assistant',content:aiResponse})}catch(error){console.error('Error saat mengirim pesan:',error);const errorResponse=document.createElement('div');errorResponse.className='response';errorResponse.textContent="Terjadi kesalahan, silakan coba lagi.";chatContainer.appendChild(errorResponse)}finally{hideTypingIndicator(typingIndicator);chatContainer.scrollTop=chatContainer.scrollHeight}};messageInput.addEventListener('keydown',(e)=>{if(e.key==='Enter')sendMessage()});const toggleBtn=document.getElementById('navbarOpen');const navLinks=document.getElementById('navLinks');toggleBtn.addEventListener('click',()=>{navLinks.classList.toggle('active')})});
